"use strict";(()=>{var e={};e.id=193,e.ids=[193],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},629:(e,t,a)=>{a.r(t),a.d(t,{config:()=>_,default:()=>x,routeModule:()=>w});var r={};a.r(r),a.d(r,{default:()=>handler});var l=a(762),i=a(59),o=a(718);let n=require("canvas"),s={WIDTH:1080,HEIGHT:1080},m={PRIMARY_TEXT:"#F5F2ED"},p={template1:{file:"theme-01.png",label:"Template 1"},template2:{file:"theme-02.png",label:"Template 2"},template3:{file:"theme-03.png",label:"Template 3"},template4:{file:"theme-04.png",label:"Template 4"},template5:{file:"theme-05.png",label:"Template 5"},template6:{file:"theme-06.png",label:"Template 6"}},c={PATHS:{JOST_MEDIUM:"public/font/Jost-Medium.ttf",JOST_BOLD:"public/font/Jost-Bold.ttf",CRIMSON_REGULAR:"public/font/CrimsonText-Regular.ttf"},FAMILIES:{JOST_MEDIUM:"Jost Medium",JOST_BOLD:"Jost Bold",CRIMSON_REGULAR:"CrimsonText Regular"}},d={MAX_WIDTH_RATIO:.7,MARGIN_TOP_RATIO:.35,LINE_HEIGHT:1.5,TEXT_OPACITY:.85},g={template1:{font:{family:c.FAMILIES.JOST_MEDIUM,size:42,lineHeight:d.LINE_HEIGHT,color:m.PRIMARY_TEXT,opacity:d.TEXT_OPACITY},boldFont:{family:c.FAMILIES.JOST_BOLD,size:42,lineHeight:d.LINE_HEIGHT,color:m.PRIMARY_TEXT,opacity:d.TEXT_OPACITY},layout:{maxWidth:d.MAX_WIDTH_RATIO,marginTop:d.MARGIN_TOP_RATIO,textAlign:"center"}}},u=require("path");var T=a.n(u);let h=(()=>{let e=g.template1,t=(0,n.createCanvas)(1,1),a=t.getContext("2d"),r=t.getContext("2d");a.font=`${e.font.size}px "${e.font.family}", "CrimsonText Regular", serif`,r.font=`${e.boldFont.size}px "${e.boldFont.family}", "CrimsonText Regular", serif`;let l=new Map,i=new Map;for(let e of"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789 .,:;!?'\"()-_[]{}@#$%^&*+=<>/\\|`~")l.set(e,a.measureText(e).width),i.set(e,r.measureText(e).width);return{regular:l,bold:i}})(),f=(0,n.createCanvas)(1,1),E=f.getContext("2d"),I={regular:{family:"Jost Medium",size:42},bold:{family:"Jost Bold",size:42}};function calculateWordWidth(e,t){let a=e.bold?t.bold:t.regular,r=0;for(let t of e.text){let l=a.get(t);if(void 0!==l)r+=l;else{let a=e.bold?I.bold:I.regular;E.font=`${a.size}px "${a.family}", "CrimsonText Regular", serif`,r+=E.measureText(t).width}}return r}function calculateLineWidth(e,t){let a=0;for(let r=0;r<e.length;r++){let l=e[r];a+=calculateWordWidth(l,t),r<e.length-1&&(a+=t.regular.get(" "))}return a}let TemplateService=class TemplateService{static getTemplateConfig(e){return p[e]||p.template1}static getAllTemplates(){return Object.entries(p).map(([e,t])=>({value:e,label:t.label}))}static getTemplateFileName(e){let t=this.getTemplateConfig(e);return t.file}static templateExists(e){return e in p}static getTemplateMapping(){let e={};return Object.entries(p).forEach(([t,a])=>{e[t]=a.file}),e}};let TextProcessingService=class TextProcessingService{static parseBoldText(e){let t;let a=[],r=/\*\*(.*?)\*\*/g,l=0;for(;null!==(t=r.exec(e));){if(t.index>l){let r=e.slice(l,t.index),i=this._splitIntoWords(r);a.push(...i.map(e=>({text:e,bold:!1})))}let r=this._splitIntoWords(t[1]);a.push(...r.map(e=>({text:e,bold:!0}))),l=t.index+t[0].length}if(l<e.length){let t=e.slice(l),r=this._splitIntoWords(t);a.push(...r.map(e=>({text:e,bold:!1})))}return a}static _splitIntoWords(e){return e.split(" ").filter(e=>e.length>0)}static wrapTextToLines(e,t,a){let r=[],l=[],i=t;for(let a of e){let e=calculateWordWidth(a,h),o=h.regular.get(" ");e<=i?(l.push(a),(i-=e)>=o&&(i-=o)):(l.length>0&&r.push(l),l=[a],(i=t-e)>=o&&(i-=o))}return l.length>0&&r.push(l),r}static calculateTextPositioning(e,t,a){let r=a.font.size*a.font.lineHeight,l=t*a.layout.maxWidth,i=t/2,o=t*a.layout.marginTop,n=e.map((t,a)=>{let l=calculateLineWidth(t,h),n=o-(e.length-1)*r/2+a*r;return{line:t,lineStartX:i-l/2,lineY:n,lineWidth:l}});return{linePositions:n,lineHeight:r,maxWidth:l}}static parseTextWithLineBreaks(e){return e.split("---").map(e=>e.trim()).filter(e=>e.length>0)}static calculateWordWidth(e,t){return calculateWordWidth(e,t)}static calculateLineWidth(e,t){return calculateLineWidth(e,t)}};let ImageGenerationError=class ImageGenerationError extends Error{constructor(e,t,a=null){super(e),this.name="ImageGenerationError",this.code=t,this.originalError=a}};let TemplateError=class TemplateError extends Error{constructor(e,t,a=null){super(e),this.name="TemplateError",this.templateName=t,this.originalError=a}};let FontError=class FontError extends Error{constructor(e,t,a=null){super(e),this.name="FontError",this.fontFamily=t,this.originalError=a}};let ValidationError=class ValidationError extends Error{constructor(e,t,a=null){super(e),this.name="ValidationError",this.field=t,this.originalError=a}};let handleApiError=(e,t)=>(console.error("API Error:",e),e instanceof ValidationError)?t.status(400).json({success:!1,message:e.message,field:e.field}):e instanceof TemplateError?t.status(404).json({success:!1,message:`Template not found: ${e.templateName}`,code:"TEMPLATE_NOT_FOUND"}):e instanceof FontError?t.status(500).json({success:!1,message:`Font loading failed: ${e.fontFamily}`,code:"FONT_ERROR"}):e instanceof ImageGenerationError?t.status(500).json({success:!1,message:e.message,code:e.code}):t.status(500).json({success:!1,message:"Internal server error",code:"INTERNAL_ERROR"}),validateText=e=>{if(!e||"string"!=typeof e)throw new ValidationError("Text is required","text");if(0===e.trim().length)throw new ValidationError("Text cannot be empty","text");if(e.length>1e3)throw new ValidationError("Text is too long (max 1000 characters)","text")},validateTemplate=e=>{if(!e||"string"!=typeof e)throw new ValidationError("Template is required","template");if(!["template1","template2","template3","template4","template5","template6"].includes(e))throw new ValidationError(`Invalid template: ${e}`,"template")};let ImageGenerator=class ImageGenerator{constructor(){this.templatePath="/public/templates/",this.templateMapping=TemplateService.getTemplateMapping(),this.registerFonts()}registerFonts(){try{(0,n.registerFont)(T().join(process.cwd(),c.PATHS.JOST_MEDIUM),{family:c.FAMILIES.JOST_MEDIUM}),(0,n.registerFont)(T().join(process.cwd(),c.PATHS.JOST_BOLD),{family:c.FAMILIES.JOST_BOLD}),(0,n.registerFont)(T().join(process.cwd(),c.PATHS.CRIMSON_REGULAR),{family:c.FAMILIES.CRIMSON_REGULAR})}catch(e){throw new FontError("Font registration failed","all",e)}}async generateImage(e,t="template1"){try{let a=await this.loadTemplate(t),r=TextProcessingService.parseTextWithLineBreaks(e),l=[];for(let e of r){let t=await this.createImageWithText(e,a);l.push(t)}return l}catch(e){if(e instanceof ImageGenerationError||e instanceof TemplateError||e instanceof FontError)throw e;throw new ImageGenerationError(`Image generation failed: ${e.message}`,"GENERATION_FAILED",e)}}async loadTemplate(e){try{let t=this.templateMapping[e]||TemplateService.getTemplateFileName("template1");return await (0,n.loadImage)(T().join(process.cwd(),this.templatePath+t))}catch(t){throw new TemplateError(`Failed to load template: ${e}`,e,t)}}async createImageWithText(e,t){let a=(0,n.createCanvas)(s.WIDTH,s.HEIGHT),r=a.getContext("2d");r.drawImage(t,0,0,s.WIDTH,s.HEIGHT);let l=g.template1;return this.applyTypography(r,e,l,s.WIDTH),a.toBuffer("image/png")}applyTypography(e,t,a,r){e.textAlign="left",e.textBaseline="middle",this.addTextShadow(e);let l=r*a.layout.maxWidth,i=r*a.layout.marginTop;this.parseAndRenderText(e,t,r/2,i,l,a)}parseAndRenderText(e,t,a,r,l,i){let o=TextProcessingService.parseBoldText(t),n=TextProcessingService.wrapTextToLines(o,l,i),s=i.font.size*i.font.lineHeight,m=r-(n.length-1)*s/2;n.forEach((t,r)=>{let l=a,o=m+r*s,n=TextProcessingService.calculateLineWidth(t,h);l=a-n/2,t.forEach((t,a)=>{let r=t.bold?i.boldFont:i.font;if(e.font=`${r.size}px "${r.family}", "CrimsonText Regular", serif`,e.fillStyle=r.color,e.globalAlpha=r.opacity,a>0){let e=h.regular.get(" ");l+=e}e.fillText(t.text,l,o);let n=TextProcessingService.calculateWordWidth(t,h);l+=n})})}addTextShadow(e){e.shadowColor="rgba(0, 0, 0, 0.3)",e.shadowBlur=2,e.shadowOffsetX=0,e.shadowOffsetY=0}};async function handler(e,t){if("POST"!==e.method)return t.status(405).json({message:"Method not allowed"});try{let{text:a,template:r="template1"}=e.body;validateText(a),validateTemplate(r);let l=new ImageGenerator,i=await l.generateImage(a,r),o=i.map((e,t)=>({id:t+1,data:e.toString("base64"),mimeType:"image/png"}));t.status(200).json({success:!0,message:`Generated ${i.length} image(s)`,imageCount:i.length,images:o})}catch(e){return handleApiError(e,t)}}let x=(0,o.l)(r,"default"),_=(0,o.l)(r,"config"),w=new l.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/generate-image",pathname:"/api/generate-image",bundlePath:"",filename:""},userland:r})}};var t=require("../../webpack-api-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),a=t.X(0,[836],()=>__webpack_exec__(629));module.exports=a})();